<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title or 'Ciplas' }} | Programador Cuerdas</title>
    <meta name="description" content="Sistema de programación de producción para la Línea de Cordelería - Ciplas">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="{{ session.get('theme', 'dark') }}">
    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 style="font-size: 1.2rem; font-weight: 800; color: var(--accent-blue);">Ciplas</h2>
                <span style="font-size: 0.7rem; color: #94A3B8;">Línea Cordelería</span>
            </div>
            <nav class="sidebar-nav">
                <a href="{{ url_for('dashboard') }}" class="nav-link {{ 'active' if active_page == 'dashboard' }}">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
                <a href="{{ url_for('backlog') }}" class="nav-link {{ 'active' if active_page == 'backlog' }}">
                    <i class="bi bi-list-check"></i> Backlog
                </a>
                <a href="{{ url_for('programming') }}" class="nav-link {{ 'active' if active_page == 'programming' }}">
                    <i class="bi bi-calendar3"></i> Programación
                </a>
                <a href="{{ url_for('config') }}" class="nav-link {{ 'active' if active_page == 'config' }}">
                    <i class="bi bi-gear"></i> Configuración
                </a>
            </nav>
            <div style="margin-top: auto; padding: 1rem;">
                <span style="font-size: 0.75rem; color: #94A3B8;">{{ session.get('user_email', '') }}</span>
                <a href="{{ url_for('logout') }}" style="display: block; margin-top: 0.5rem; font-size: 0.8rem; color: #EF4444;">
                    <i class="bi bi-box-arrow-left"></i> Cerrar Sesión
                </a>
            </div>
        </aside>
        
        <main class="main-content">
            <header class="main-header">
                <h1>{% block header_title %}{{ title }}{% endblock %}</h1>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button onclick="toggleTheme()" class="btn" style="background: none; border: 1px solid var(--border-color); padding: 0.4rem 0.8rem; font-size: 0.8rem;">
                        <i class="bi bi-moon"></i>
                    </button>
                </div>
            </header>
            <div class="content-area">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}" style="margin-bottom: 1rem; padding: 0.75rem 1rem; border-radius: 6px; background: {{ '#065F46' if category == 'success' else '#7F1D1D' }}; color: white;">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>
    
    <script>
        async function toggleTheme() {
            await fetch('/toggle-theme', { method: 'POST' });
            location.reload();
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
