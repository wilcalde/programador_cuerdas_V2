<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ciplas AI-Master Cord - {{ title }}</title>
    <!-- Montserrat Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons (Icons used in Streamlit) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- User CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    {% block head %}{% endblock %}
</head>

<body class="{% if session.get('theme') == 'light' %}light-mode{% endif %}">

    <nav class="sidebar">
        <div class="logo-container">
            <h2 style="font-size: 1.2rem; color: #38BDF8;">Ciplas AI-Master</h2>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/" class="nav-link {% if active_page == 'dashboard' %}active{% endif %}">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="/backlog" class="nav-link {% if active_page == 'backlog' %}active{% endif %}">
                    <i class="bi bi-list-task"></i> Backlog
                </a>
            </li>
            <li class="nav-item">
                <a href="/programming" class="nav-link {% if active_page == 'programming' %}active{% endif %}">
                    <i class="bi bi-calendar-check"></i> Simulación
                </a>
            </li>
            <li class="nav-item">
                <a href="/config" class="nav-link {% if active_page == 'config' %}active{% endif %}">
                    <i class="bi bi-gear"></i> Configuración
                </a>
            </li>

        </ul>

        <div class="sidebar-footer">
            <button onclick="toggleTheme()" class="btn btn-primary" style="width: 100%;">
                <i class="bi bi-circle-half"></i> Cambiar Modo
            </button>
            <a href="/logout" class="nav-link" style="margin-top: 1rem; color: #94A3B8;">
                <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
            </a>
        </div>
    </nav>

    <main class="main-content">
        <header class="header">
            <h1>{% block header_title %}{% endblock %}</h1>
            <div class="user-info">
                <span>{{ session.get('user_email', 'Invitado') }}</span>
            </div>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}"
            style="padding: 1rem; border-radius: 8px; margin-bottom: 1rem; background: rgba(56, 189, 248, 0.1); border: 1px solid var(--accent-blue);">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <script>
        function toggleTheme() {
            fetch('/toggle-theme', { method: 'POST' })
                .then(() => location.reload());
        }
    </script>
    {% block scripts %}{% endblock %}
</body>

</html>